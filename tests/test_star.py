import gollyx_python
import unittest
from .fixtures_star import (
    rainbowmath_120_180_finegrained_gold
)


class StarGenerationsTest(unittest.TestCase):

    STATE1 = '[{"0":[16,41,51,66,86,111,121,126,136,141,146,156,176]},{"1":[16,26,46,61,81,91,111,141]},{"2":[16,21,76,101]},{"3":[16,21,41,71,86,101,151,161,166,171,176]},{"4":[31,66,81,106,116,121,126,136,161]},{"6":[0,13,17,18,19,38,42,47,69,77,79,82,83,92,93,102,118,139,142,144,153,164,169,173,177]},{"7":[16,26,96,106,116,156]},{"8":[11,46,61,66,136,171]},{"9":[6,11,16,26,46,76,86,91,111,116,121,136,141,146,156,161,166]},{"11":[2,4,8,9,12,18,23,24,29,32,33,34,37,38,39,47,52,58,59,64,68,69,93,108,113,118,119,127,128,129,133,139,143,148,158,162]},{"12":[41,81,91,111,136,141,161]},{"13":[41,46,96,106,116,146,151,176]},{"14":[16,31,36,61,76,81,91,121,126,146,151]},{"16":[2,12,24,34,43,53,54,58,59,64,79,84,109,117,124,128,132,139,144,147,152,153,157,167,172,174,179]},{"17":[6,21,101,106,121,126,166,176]},{"18":[26,41,71,156]},{"19":[11,61,76,141,146,176]},{"21":[0,3,28,44,53,59,79,84,87,88,92,94,99,109,114,117,119,132,153,167,169]},{"22":[36,61,71,121,126,131,176]},{"23":[11,16,86,111,141,156,166]},{"24":[41,56,66,121,131,161,166,176]},{"26":[1,4,17,28,29,38,49,59,68,74,77,82,83,92,93,94,112,118,122,124,127,129,133,137,139,144,152,153,154,162,163,169,172,179]},{"27":[21,31,46,61,91,96,106,116,131,146,176]},{"28":[6,11,31,56,71,96,126,156]},{"29":[6,51,76,86,106,121,126,131,136,141,166,176]},{"31":[0,1,2,7,24,27,33,47,53,89,102,108,112,113,124,127,129,134,147,152,157,159,163,167,173,174,179]},{"32":[16,101,111,121,126,131,141,156,171]},{"33":[26,31,116,161]},{"34":[21,26,36,41,66,101,121,146,156,166]},{"36":[12,18,22,23,32,34,39,44,47,53,63,73,74,78,83,103,107,108,109,118,122,123,134,137,148,157,167,178]},{"37":[11,16,66,86,111,126,131]},{"38":[51,66,81,86,151]},{"39":[21,26,46,91,106,121,126,156,171]},{"41":[2,4,7,9,17,19,29,34,38,39,42,49,72,74,83,89,99,108,112,119,122,128,129,133,137,139,142,164,178]},{"42":[11,46,56,61,71,76,81,126,136,161,171]},{"43":[11,26,36,56,121,146,161,171]},{"44":[6,16,51,66,71,76,126,136,146,151,156,171,176]},{"46":[0,1,4,7,9,18,19,24,28,34,38,42,44,47,62,64,67,73,77,78,93,97,98,103,108,112,118,132,139,147,148,152,167]},{"47":[11,31,71,141,166]},{"48":[31,61,71,76,91,101,121,146,176]},{"49":[31,71,86,91,111,116,121,136,141,146]},{"51":[1,3,12,38,39,48,54,64,67,82,92,93,94,99,123,137,142,143,149,157,162,168,173,177]},{"52":[26,46,51,61,101,106,121,151,161,166]},{"53":[16,41,61,76,106,141,161,171]},{"54":[11,26,31,56,61,66,76,96,151]},{"56":[2,8,9,44,47,49,58,62,69,79,88,97,104,112,118,119,128,134,138,144,147,149,152,157,167,168,172,173]},{"57":[6,36,56,66,71,81,101,126]},{"58":[6,26,56,61,66,71,111,116,141,146,156,166]},{"59":[31,41,61,66,86,111,116,121,141,151]},{"61":[0,2,3,4,7,14,17,18,23,32,38,64,68,72,83,84,93,118,119,124,128,133,134,148,149,159,163,172,174,177,179]},{"62":[16,31,46,111,121,136,146]},{"63":[26,31,46,61,86,91,101,106,116,156]},{"64":[46,81,106,111,121,146,156]},{"66":[3,8,9,14,19,47,59,72,74,77,84,87,89,92,104,107,118,124,143,153,158,179]},{"67":[6,21,51,61,91,96,106,111,131,141,146]},{"68":[6,26,56,61]},{"69":[6,46,56,91,116,131,141,166,176]},{"71":[0,1,2,3,14,17,18,27,43,49,54,63,64,69,72,73,77,88,97,99,114,119,123,132,143,148,153,154,157,158,162,163,174,179]},{"72":[11,36,91,106,111,116,121,166]},{"73":[6,16,56,91,96,116,136,146,161,176]},{"74":[6,21,26,31,36,46,81,121,156]},{"76":[0,1,2,12,22,24,34,53,57,77,78,84,97,102,113,114,117,119,123,128,134,137,139,144,152,162,172]},{"77":[16,31,56,76,91,111,116,141,146,151]},{"78":[41,66,101,111,131,136,151,176]},{"79":[6,36,46,51,56,81,141,156,161]},{"81":[0,23,28,29,32,37,38,43,52,64,69,92,98,108,112,117,122,129,148,152,158,173]},{"82":[6,36,66,96,116,126,131,136,166]},{"83":[36,46,56,61,66,71,76,86,101,111,141,156]},{"84":[16,46,61,66,71,86,116,121,136,146,156,166]},{"86":[1,4,7,17,18,19,22,23,27,28,34,39,47,52,54,69,77,83,87,89,94,122,133,134,142,144,152,153,158,164,172,177,178]},{"87":[6,56]},{"88":[6,11,16,51,76,141,146,151,166]},{"89":[16,71,96,101,106,156,161]},{"91":[0,4,12,34,39,44,49,52,53,57,58,63,68,69,73,77,88,99,113,119,143,147,149,162,164,172,173,174,178]},{"92":[6,16,21,41,76,116,126,141,166,176]},{"93":[51,56,66,91,101,121,161,176]},{"94":[26,46,76,86,121,126,136,146,166]},{"96":[24,38,42,43,53,54,64,82,87,88,92,93,99,102,108,109,119,124,127,129,147,158,164,167,169]},{"97":[6,11,31,51,66,71,76,101,146,151]},{"98":[6,61,81,91,101,116,121,136,141,161]},{"99":[6,46,66,111,121,136]},{"101":[8,13,24,33,38,44,57,58,63,64,67,82,83,84,88,89,92,97,98,99,107,113,133,138,143,149,152,158,162,169,172]},{"102":[31,91,136,146,156,161,176]},{"103":[21,31,46,56,71,106,126,141,146,156,171,176]},{"104":[41,51,71,76,81,96,146,156,166]},{"106":[3,8,13,17,23,32,33,34,37,39,53,58,62,67,74,79,92,98,103,107,119,123,127,143,144,148,149,172,174]},{"107":[16,26,36,46,91,96,136]},{"108":[6,56,76,81,106,141,161]},{"109":[36,96,106,111,121,136,141,166,171]},{"111":[3,13,18,19,23,24,29,32,34,39,47,54,72,79,84,98,102,109,112,123,127,137,152,154,157,158,164,169,172,174]},{"112":[16,31,46,51,61,66,91,96,101,121,156]},{"113":[16,41,46,81,121,141,146,156,166]},{"114":[11,31,76,111,146,151,156]},{"116":[1,2,3,14,24,39,48,73,77,79,99,103,139,144,159,167,172,174]},{"117":[6,16,36,96,106,146,151,156,166]},{"118":[11,26,51,61,76,126,156,161,176]},{"119":[6,56,91,111,146,151,166]}]'
    STATE2 = '[{"0":[11,76,116,166,171]},{"1":[6,21,41,51,76,101,136,146,151,156]},{"2":[11,46,51,81,126,131,136,161,171]},{"3":[11,31,96,126,136]},{"4":[16,21,26,46,91,131]},{"6":[1,24,28,29,32,39,44,49,62,84,88,94,103,108,113,122,123,128,132,133,143,148,152,154,158,167]},{"7":[6,41,46,51,76,146,161,166,176]},{"8":[6,51,71,86,106,116,131,146,151]},{"9":[36,81,151]},{"11":[1,3,14,19,22,28,42,54,57,67,74,78,79,98,102,104,124,134,138,147,157,163,168,169,172,173,174,178]},{"12":[16,46,71,96,106,116,156,166,176]},{"13":[6,11,51,61,76,81,131,141,156,161]},{"14":[11,21,26,86,96,156,161,171]},{"16":[4,22,23,27,52,83,88,89,92,97,102,103,104,112,119,138,142,159,162,164,169,173,178]},{"17":[11,31,46,71,76,91,116]},{"18":[11,31,46,76,86,101,106,111,116,136,151,161]},{"19":[16,21,56,71,131,151,156,161,171]},{"21":[1,2,22,24,33,34,39,49,57,64,69,74,83,102,104,107,108,122,127,134,137,139,142,144,147,152,154,163]},{"22":[76,81]},{"23":[26,66,71,101,106,116,131,146,151,161]},{"24":[6,31,81,86,116,141,151,171]},{"26":[2,12,13,27,39,53,54,62,63,79,84,87,97,108,109,123,134,142,147,149,159,167,178]},{"27":[26,36,41,51,76,86,141]},{"28":[21,26,36,46,66,81,86,116,121,131,151]},{"29":[26,56,61,71,101,111,116,151,156,161]},{"31":[3,13,14,23,34,42,43,48,67,73,83,84,87,88,93,107,117,118,122,128,132,137,148,153,177,178]},{"32":[31,36,41,51,71,76,86,106,166]},{"33":[11,16,21,36,41,76,91,106,121,126,141,156,166]},{"34":[71,76,81,106]},{"36":[1,13,28,58,64,77,82,98,113,117,124,132,133,142,143,152,153,159,162,168,169,173]},{"37":[6,36,41,51,56,96,151,166]},{"38":[16,26,41,61,91,96,101,106,111,131,156]},{"39":[16,31,71,81,136,141,146,176]},{"41":[13,14,37,43,47,57,63,64,79,82,84,87,103,104,123,124,134,153,157,158,169,174]},{"42":[21,101,106,121,146,151,176]},{"43":[21,41,61,66,76,81,86,91,116,126,151,176]},{"44":[11,36,46,81,86,101,121,141]},{"46":[2,3,12,14,22,23,33,39,54,63,72,79,84,92,102,104,107,127,128,134,143,158,159,163,168,172]},{"47":[6,21,51,76,101,116,121,136,151,156,171]},{"48":[21,81,131,151,166]},{"49":[6,11,36,41,56,96,106,151,156,161,166,176]},{"51":[0,9,17,23,34,37,44,49,59,63,68,78,84,89,97,102,104,108,112,113,118,124,127,133,134,144,148,159,163,179]},{"52":[31,36,56,81,126,131,136,141,171,176]},{"53":[6,11,26,46,51,56,86,96,111,121,126,166,176]},{"54":[46,71,91,101,116,131,136,141,146,156]},{"56":[0,1,3,19,27,32,38,48,52,63,74,78,83,84,87,93,94,99,102,103,107,108,113,114,132,142,143,154]},{"57":[11,16,21,26,31,41,51,86,111,121,131,151,161]},{"58":[16,21,46,51,76,86,101,151,171]},{"59":[11,36,71,106,161,176]},{"61":[8,13,24,29,39,42,48,53,57,63,69,79,88,89,92,97,102,108,109,117,127,129,144,157,158,178]},{"62":[6,86,91,96,106,126,171]},{"63":[6,41,56,66,71,76,96,136,146]},{"64":[6,16,36,56,71,91,126,151,166]},{"66":[1,2,7,12,17,27,28,29,32,37,38,43,49,57,62,63,67,68,69,102,108,112,122,127,128,129,134,138,148,149,154,163,168,172,178]},{"67":[16,26,36,66,86,116,136,156,161]},{"68":[11,16,21,51,66,71,106,151,161,166,171]},{"69":[21,26,41,66,76,101,126,136,161]},{"71":[8,9,13,28,29,34,37,42,44,58,78,79,87,93,98,102,108,113,122,128,137,142,164,167,168,172]},{"72":[41,71,96,126,131,141,161,176]},{"73":[11,26,51,61,76,101,111,151,156]},{"74":[71,96,116,126]},{"76":[3,4,9,14,18,27,29,39,52,54,59,62,64,68,69,74,79,89,92,94,98,107,108,124,127,129,138,143,147,148,154,158,163,177]},{"77":[11,21,96,106,161,171]},{"78":[46,56,71,81,91,96,121,146,156,166]},{"79":[41,66,86,101,116,131,136,146,171,176]},{"81":[2,4,14,18,22,33,49,53,57,62,67,72,77,79,82,88,89,103,104,119,124,137,139,147,162,163,164,172,174,178]},{"82":[11,26,31,46,51,76,81,91,106,171]},{"83":[6,11,16,51,106,136,146]},{"84":[6,56,91,101,106,131,171,176]},{"86":[8,9,13,14,24,32,37,49,58,59,63,64,68,73,78,84,88,98,99,103,112,113,114,128,132,143,149,154,157,163]},{"87":[41,46,96,111,121,126,156,161]},{"88":[26,41,61,91,101,111,121,156,161]},{"89":[6,11,26,61,91,126,176]},{"91":[1,8,13,17,22,43,54,59,67,79,84,87,92,98,108,117,127,129,137,138,139,142,144,153,159,163,167,177]},{"92":[26,36,46,81,91,101,146]},{"93":[16,31,41,46,61,81,106,116,126,131,136,146,166]},{"94":[11,16,21,51,56,61,71,96,106,131,156,161]},{"96":[0,1,2,12,18,22,27,37,52,62,67,74,78,83,94,103,107,114,117,118,133,138,139,142,143,144,148,154,159,163,174,178]},{"97":[26,81,91,161,176]},{"98":[11,16,41,46,106,146,171]},{"99":[11,21,26,31,51,56,71,86,91,141,151,171]},{"101":[1,14,17,28,29,34,42,47,69,72,74,78,93,102,103,109,114,117,118,122,123,137,139,142,147,153,154,168,174,177,179]},{"102":[11,16,41,81,101,121,131,141,151,166]},{"103":[26,61,86,96,101,131,136,151,166]},{"104":[6,16,26,36,56,66,106,136,151,171,176]},{"106":[0,1,4,7,12,18,22,38,57,63,68,87,89,93,97,99,108,109,122,157,159,177]},{"107":[11,76,111,116,126,156,176]},{"108":[31,86,101,111,121,126,146,166,176]},{"109":[41,46,76,116,131,151]},{"111":[2,8,9,17,42,43,49,57,64,68,88,89,92,99,113,117,122,124,133,134,138,139,144,147,153,159,162,167,173,179]},{"112":[6,11,26,36,56,71,76,81,106,136,161]},{"113":[6,11,26,56,61,71,76,111,116,171]},{"114":[21,51,81,91,96,106,126,131,136,161,176]},{"116":[7,17,18,22,23,28,29,33,37,42,47,53,62,63,82,83,84,98,104,107,109,112,113,123,128,129,137,147,148,157,158,168,173]},{"117":[11,26,116,121]},{"118":[36,41,46,71,81,91,101,111,121,171]},{"119":[16,51,71,76,81,121,131,141,176]}]'

    ROWS = 120
    COLS = 180

    star_wars_b = [2]
    star_wars_s = [3, 4, 5]
    star_wars_c = 4

    caterpillars_b = [3, 7, 8]
    caterpillars_s = [1, 2, 4, 5, 6, 7]
    caterpillars_c = 4

    def test_constructor(self):
        """
        Test that we can successfully construct a Generations CA
        """
        gollyx_python.StarGOLGenerations(
            s1 = self.STATE1,
            s2 = self.STATE2,
            rows = self.ROWS,
            columns = self.COLS,
            rule_b=self.star_wars_b,
            rule_s=self.star_wars_s,
            rule_c=self.star_wars_c,
            periodic=True
        )

    def test_steps(self):
        """
        Check that we can step through the algorithm several times without errors
        """
        gol = gollyx_python.StarGOLGenerations(
            s1 = self.STATE1,
            s2 = self.STATE2,
            rows = self.ROWS,
            columns = self.COLS,
            rule_b=self.star_wars_b,
            rule_s=self.star_wars_s,
            rule_c=self.star_wars_c,
            periodic=True
        )
        for i in range(5):
            gol.next_step()

    def test_star_wars_120_180(self):
        """
        Check the actual results of steps against known good results from JS simulator
        """
        gol = gollyx_python.StarGOLGenerations(
            s1 = self.STATE1,
            s2 = self.STATE2,
            rows = self.ROWS,
            columns = self.COLS,
            rule_b=self.star_wars_b,
            rule_s=self.star_wars_s,
            rule_c=self.star_wars_c,
            periodic=True
        )
        live_counts = gol.count()

        gold = rainbowmath_120_180_finegrained_gold
        for gold_generation, gold_color1, gold_color2, gold_color3 in gold:
            try:
                self.assertEqual(live_counts['generation'], gold_generation)
                self.assertEqual(live_counts['liveCellsColors'][0], gold_color1)
                self.assertEqual(live_counts['liveCellsColors'][1], gold_color2)
                self.assertEqual(live_counts['liveCellsColors'][2], gold_color3)
            except AssertionError:
                err = "Error: did not match counts on generation {gold_generation}"
                err += "\ngold 1, 2: {gold_color1} , {gold_color2}"
                err += "\ncalc 1, 2: {live_counts['liveCellsColors'][0]} , {live_counts['liveCellsColors'][0]}"
                raise Exception(err)
            live_counts = gol.next_step()
